# Publishing UI Package to NPM

This guide explains how to build the `@monorepo/ui` package and publish it to npm as `@fe-monorepo/ui`.

## Overview

The publishing process involves three main steps:

1. **Build** the source package (`packages/ui`) to generate compiled JavaScript and TypeScript declaration files
2. **Copy** the built `dist` folder to the publish package (`packages/ui-public`)
3. **Publish** the `packages/ui-public` package to npm

### Package Structure

- **Source Package**: `packages/ui` - Contains TypeScript source code
- **Publish Package**: `packages/ui-public` - Contains built files ready for npm distribution
- **Build Output**: `packages/ui/dist` - Generated by TypeScript compiler

## Step 1: Build the UI Package

Build the `@monorepo/ui` package to compile TypeScript files into JavaScript and generate type declarations.

### From the root directory:

```bash
pnpm build:ui
```

### Or from within the package:

```bash
cd packages/ui
pnpm build
```

### What happens during build:

- TypeScript compiler (`tsc`) processes all source files
- JavaScript files (`.js`) are generated in `packages/ui/dist/`
- TypeScript declaration files (`.d.ts`) are created for type support
- Declaration maps (`.d.ts.map`) are generated for better IDE experience

### Verify the build:

After building, check that the `dist` folder exists and contains the expected files:

```bash
ls -la packages/ui/dist
```

## Step 2: Copy dist to ui-public

Copy the built `dist` folder from `packages/ui` to `packages/ui-public`.

### Remove old dist (if exists) and copy new one:

```bash
# Remove old dist folder
rm -rf packages/ui-public/dist

# Copy the new dist folder
cp -r packages/ui/dist packages/ui-public/dist
```

### One-liner command:

```bash
rm -rf packages/ui-public/dist && cp -r packages/ui/dist packages/ui-public/dist
```

### Verify the copy:

```bash
ls -la packages/ui-public/dist
```

You should see the same structure as `packages/ui/dist`.

## Step 3: Publish to NPM

Publish the `packages/ui-public` package to npm.

### Navigate to the publish package:

```bash
cd packages/ui-public
```

### Publish:

```bash
pnpm publish
```

## Important Prerequisites

Before publishing, ensure you have:

### 1. NPM Authentication

Make sure you're logged in to npm:

```bash
npm login
```

Verify your login:

```bash
npm whoami
```

### 2. Version Management

Check and update the version in `packages/ui-public/package.json`:

- The version must be higher than the current published version on npm
- Follow [semantic versioning](https://semver.org/): `MAJOR.MINOR.PATCH`
- Or use automatic version bumping:

```bash
pnpm publish --bump patch   # 1.0.0 → 1.0.1
pnpm publish --bump minor   # 1.0.0 → 1.1.0
pnpm publish --bump major   # 1.0.0 → 2.0.0
```

### 3. Publishing Permissions

- The package `@fe-monorepo/ui` has `"access": "public"` in `publishConfig`
- Ensure you have permission to publish to the `@fe-monorepo` scope
- If you're the first publisher, you may need to create the organization on npm

### 4. Test Publishing (Optional)

Before publishing to production, you can test with a beta tag:

```bash
pnpm publish --tag beta
```

Then install it with:

```bash
npm install @fe-monorepo/ui@beta
```

## Complete Workflow (One-liner)

You can combine all steps into a single command:

```bash
pnpm build:ui && rm -rf packages/ui-public/dist && cp -r packages/ui/dist packages/ui-public/dist && cd packages/ui-public && pnpm publish
```

## Using Changesets (Recommended)

If your project uses Changesets for version management, follow this workflow:

### 1. Create a changeset

Document your changes:

```bash
pnpm changeset:init
```

This will prompt you to describe the changes and select the version bump type.

### 2. Version bump

Apply the changesets and update versions:

```bash
pnpm changeset:version
```

This will:

- Update version numbers in `package.json` files
- Generate or update `CHANGELOG.md` files
- Remove the consumed changeset files

### 3. Build and publish

After versioning, build and publish:

```bash
# Build the UI package
pnpm build:ui

# Copy dist to ui-public
rm -rf packages/ui-public/dist && cp -r packages/ui/dist packages/ui-public/dist

# Publish
cd packages/ui-public && pnpm publish
```

Or use the changeset publish command (if configured):

```bash
pnpm changeset:publish
```

## Expected File Structure

After building and copying, the `packages/ui-public` structure should look like:

```
packages/ui-public/
├── dist/
│   ├── index.js              # Main entry point
│   ├── index.d.ts            # TypeScript declarations
│   ├── index.d.ts.map        # Declaration source maps
│   ├── components/           # Component files
│   │   ├── *.jsx
│   │   └── *.d.ts
│   ├── libs/                 # Utility libraries
│   │   ├── *.js
│   │   └── *.d.ts
│   └── v1/                   # Version 1 exports
│       ├── animate-ui/
│       ├── hooks/
│       ├── libs/
│       └── shadcn-ui/
├── package.json              # Package configuration
├── README.md                 # Package documentation
└── CHANGELOG.md              # Version history
```

## Troubleshooting

### Error: "You do not have permission to publish"

**Solutions:**

1. Verify you're logged in:

   ```bash
   npm whoami
   ```

2. Check your permissions for the `@fe-monorepo` scope on npm

3. Ensure `publishConfig.access` is set to `"public"` in `package.json`

4. If you're publishing a new scope, you may need to create the organization on npm first

### Error: "This package has already been published"

**Solutions:**

1. Update the version in `packages/ui-public/package.json`:

   ```json
   {
     "version": "1.0.1" // Increment from current version
   }
   ```

2. Or use automatic version bumping:
   ```bash
   pnpm publish --bump patch
   ```

### Error: "dist folder not found" or "dist folder is empty"

**Solutions:**

1. Ensure you've run the build command:

   ```bash
   pnpm build:ui
   ```

2. Verify the dist folder exists:

   ```bash
   ls -la packages/ui/dist
   ```

3. Check for build errors in the console output

4. Ensure TypeScript compilation completed successfully

### Error: "Module not found" after publishing

**Solutions:**

1. Verify all exports in `package.json` point to correct paths in `dist/`

2. Check that the `dist` folder structure matches the export paths

3. Ensure all dependencies are listed in `package.json`

4. Test the package locally before publishing:
   ```bash
   cd packages/ui-public
   pnpm pack
   # This creates a .tgz file you can test locally
   ```

## Best Practices

1. **Always test locally** before publishing to npm
2. **Use semantic versioning** for version numbers
3. **Update CHANGELOG.md** with each release
4. **Use Changesets** for better version management
5. **Verify the build** output before copying
6. **Check npm registry** to ensure the version doesn't already exist
7. **Use beta tags** for testing before production releases

## Additional Resources

- [NPM Publishing Guide](https://docs.npmjs.com/packages-and-modules/contributing-packages-to-the-registry)
- [Semantic Versioning](https://semver.org/)
- [Changesets Documentation](https://github.com/changesets/changesets)
