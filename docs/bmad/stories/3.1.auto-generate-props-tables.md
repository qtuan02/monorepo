# Story 3.1: Generate Documentation Metadata

**Status:** Done  
**Epic:** Epic 3 - Auto-Generation & Maintenance  
**Related Documents:** [Epic 3](../epics/epic-3-auto-generation-maintenance.md), [Architecture](../architecture.md)  
**Created:** 2024-12-22

---

## Story

**As a** system  
**I want to** automatically generate component/hook metadata from source files  
**So that** documentation stays in sync with code

---

## Acceptance Criteria

1. Source code is read from component/hook files
2. Props are extracted from TypeScript interfaces
3. Hook parameters and return types are extracted
4. JSDoc comments are extracted for descriptions
5. Excludes `/v1/*` components
6. Generates JSON metadata files for frontend import
7. Updates automatically when source changes (via build script)
8. Handles file system errors gracefully

---

## Tasks / Subtasks

### Phase 1: Setup & Basic Extraction

- [ ] Create script structure
  - [ ] Create `apps/documents/scripts/generate-metadata.ts`
  - [ ] Setup ts-morph for TypeScript parsing
  - [ ] Add npm script `generate:docs`

- [ ] Implement file discovery
  - [ ] Scan `packages/ui/src/components/`
  - [ ] Scan `packages/hook/src/hooks/`
  - [ ] Exclude v1 directory
  - [ ] Generate ID from filename

### Phase 2: Source Code Extraction

- [ ] Read source code from files
  - [ ] Read file content as string
  - [ ] Store in `sourceCode` field
  - [ ] Handle read errors gracefully

### Phase 3: Props/Parameters Extraction

- [ ] Extract component props
  - [ ] Parse function parameters with ts-morph
  - [ ] Handle intersection types
  - [ ] Extract prop name, type, required status
  - [ ] Extract default values from destructuring

- [ ] Extract hook parameters
  - [ ] Parse function parameters
  - [ ] Parse return type
  - [ ] Handle generic types

- [ ] Extract JSDoc comments
  - [ ] Get descriptions from JSDoc
  - [ ] Handle @default, @param tags

### Phase 4: Category Detection (Basic)

- [ ] Assign categories based on filename patterns
  - [ ] Form: button, input, checkbox, select, etc.
  - [ ] Feedback: dialog, alert, toast, etc.
  - [ ] Data Display: table, card, badge, etc.
  - [ ] Other: Uncategorized

### Phase 5: Output Generation

- [ ] Generate JSON output
  - [ ] Write `src/generated/components.json`
  - [ ] Write `src/generated/hooks.json`
  - [ ] Create TypeScript types for imports

- [ ] Integrate with hooks
  - [ ] Update `useComponentMetadata` to import generated data
  - [ ] Update `useHookMetadata` to import generated data

### Phase 6: Testing

- [ ] Write tests for metadata generation
- [ ] Manual verification with dev server

---

## Dev Notes

### Output Structure

```typescript
// apps/documents/src/generated/components.json
{
  "components": [
    {
      "id": "button",
      "name": "Button",
      "description": "A button component",
      "category": "Form",
      "package": "ui",
      "filePath": "packages/ui/src/components/button.tsx",
      "sourceCode": "import { ... } ...",
      "props": [
        {
          "name": "variant",
          "type": "\"default\" | \"destructive\" | ...",
          "required": false,
          "defaultValue": "\"default\"",
          "description": "The button variant"
        }
      ]
    }
  ]
}
```

### Technology

- **ts-morph**: TypeScript AST parsing
- **Node.js fs**: File system operations
- **glob**: File pattern matching

### Files to Create

- `apps/documents/scripts/generate-metadata.ts`
- `apps/documents/src/generated/components.json`
- `apps/documents/src/generated/hooks.json`
- `apps/documents/src/generated/types.ts`

---

## Change Log

| Date       | Version | Description        | Author   |
| ---------- | ------- | ------------------ | -------- |
| 2024-12-22 | 1.0     | Combined 3.1 + 3.2 | Bob (SM) |

---

## Dev Agent Record

- **Date:** 2025-12-22
- **Status:** Completed
- **Notes:**
  - Implemented `generate-metadata.ts` using `ts-morph` for AST parsing.
  - Successfully extracted props from functional components (destructured props, types, required, default values).
  - Extracted hook parameters and return types.
  - Handled generic types and complex intersection types (e.g., `React.ComponentProps<"button"> & VariantProps<...>`).
  - Verified with `Button` component and `useCountdown` hook in Dev Server.
  - Dependency added: `ts-morph@23.0.0` (via package.json).

---

## QA Results

_To be filled by QA Agent_
